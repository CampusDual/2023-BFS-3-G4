<o-form-container breadcrumb="no" breadcrumb-label-columns="name;surname" breadcrumb-separator=" " [form]="form">

    <mat-tab-group fxFill>

        <!-- Pestaña de para el perfil por defecto-->
        <mat-tab label="{{ 'PROFILE_TAB' | oTranslate }}">
            <o-form #form attr="profile_detail" service="users" entity="myUser" fxLayout="column" show-header="yes"
                header-actions="U" #oDetailForm keys="user_" keys-sql-types="VARCHAR" show-header-navigation="yes"
                (onUpdate)="saveActivitiesInDataBase()">

                <o-column title="PROFILE_DATA" layout-align="start stretch" fxFlex="80" icon="account_circle">
                    <o-image attr="avatar" label="AVATAR" fxFlex="80" width="350px"
                        empty-image="assets/images/no-image.png" sql-type="OTHERS"></o-image>
                    <o-text-input attr="name" label="NAME" fxFlex="80" required="yes" max-length="20"></o-text-input>
                    <o-text-input attr="id_client" oHidden></o-text-input>
                    <o-text-input attr="surname" label="SURNAME" fxFlex="80" required="yes"
                        max-length="30"></o-text-input>
                    <o-textarea-input attr="short_desc" label="DESCRIPTION"
                        placeholder="{{ 'ONESENTENCE' | oTranslate }}" fxFlex="80" max-length="250"></o-textarea-input>
                </o-column>
                <o-column title="ACTIVITIES" layout-align="start stretch" fxFlex="80" icon="favorite">

                    <mat-chip-list fxFlex="80">
                        <mat-chip class="activitiesChip" *ngFor="let activity of arrayActivitiesClient"
                            [disabled]="false" color="primary">
                            {{ activity }}
                        </mat-chip>
                    </mat-chip-list>

                    <o-column-collapsible title="ACTSELECT" layout-align="start stretch" fxFlex="80" expanded="no">
                        <o-grid class="activitiesGrid" #activitiesB attr="activitiesB" service="activities"
                            entity="activity" keys="id_activity" columns="activity_name;id_activity" orderable="true"
                            show-page-size="no" quick-filter="false" cols="6" sortable-columns="activity_name"
                            gutter-size="5px" detail-mode="none" (onDataLoaded)="onLoad()" pagination-controls="false"
                            controls="false" grid-item-height="60" show-footer="no">

                            <o-grid-item *ngFor="let item of activitiesB.dataArray" show-page-size="false">

                                <div fxLayout="column" fxLayoutAlign="space-evenly center">
                                    <o-button class="activitiesButton"
                                        *ngIf="arrayActivitiesClient.includes(item.activity_name)" type="STROKED"
                                        label="{{ item.activity_name }}" layout-padding color="primary"
                                        (onClick)="removeActivityFn(item.activity_name,item.id_activity)"></o-button>
                                    <o-button class="activitiesButton"
                                        *ngIf="!arrayActivitiesClient.includes(item.activity_name)" type="STROKED"
                                        label="{{ item.activity_name }}" layout-padding color="accent"
                                        (onClick)="addActivityFn(item.activity_name,item.id_activity)"></o-button>

                                </div>

                            </o-grid-item>
                        </o-grid>
                        <div fxLayout="column" fxLayoutAlign="space-evenly center" fxFlex="100">
                            <o-button type="RAISED" label="SAVEACT" layout-padding color="accent"
                                (onClick)="saveActivitiesInDataBase($event)"></o-button>
                        </div>
                    </o-column-collapsible>
                </o-column>

                <o-column title="REGISTER_DATA" layout-align="start stretch" fxFlex="80" icon="assignment">
                    <o-text-input attr="user_" label="USER" fxFlex="80" enabled="no"></o-text-input>
                    <o-row class="row-pass">
                        <o-password-input attr="password" fxFlex="80" required="yes" label="PASSWORD"
                            show-password-button="yes" [validators]="validatorsArray" (input)="onPasswordInput()">
                            <!-- Campo de entrada de contraseña -->
                            <o-validator [error-name]="'passwordNotSize'" [error-text]="'ERROR_PASS'"></o-validator>
                            <!-- Validador para el tamaño de la contraseña -->
                        </o-password-input>
                    </o-row>
                    <o-row class="row-pass">
                        <o-password-input attr="passwordConfirm" fxFlex="80" *ngIf="isPasswordModified"
                            label="{{ 'Confirm password' | oTranslate }}" show-password-button="yes"
                            [validators]="validatorsArray">
                            <!-- Campo de entrada de confirmación de contraseña -->
                            <o-validator [error-name]="'passwordNotMatched'" [error-text]="'ERROR_MATCH'"></o-validator>
                            <!-- Validador para comprobar que las contraseñas coinciden -->
                        </o-password-input>
                    </o-row>
                </o-column>

            </o-form>
        </mat-tab>

        <!-- Pestaña para las funcionalidades de anfitriona -->
        <mat-tab label="{{ 'HOST_TAB' | oTranslate }}">
            <o-form #formHost attr="host_detail" service="users" entity="myUser" fxLayout="column" show-header="yes"
                header-actions="U" keys="user_" keys-sql-types="VARCHAR" show-header-navigation="yes">
                <o-column title="HOST_DATA" layout-align="start stretch" fxFlex="80">
                    <o-textarea-input attr="description" label="DESCRIPTION" placeholder="{{ 'LONGDESC' | oTranslate }}"
                        fxFlex="80" required="yes" max-length="500"></o-textarea-input>
                    <o-combo attr="id_town" fxFlex="80" label="TOWN" service="towns" entity="town" keys="id_town"
                        columns="town_name;id_town" visible-columns="town_name" value-column="id_town"
                        class="input-padding" required="yes" sort="ASC" searchable="true"></o-combo>
                    <o-text-input attr="phonenumber" label="PHONENUMBER" fxFlex="80" required="yes"
                        max-length="15"></o-text-input>
                    <o-email-input attr="email" label="EMAILCONT" placeholder="example@example.com" fxFlex="80"
                        required="yes"></o-email-input>
                    <o-nif-input attr="nif" label="NIF" required="yes" fxFlex="80" required="yes"
                        max-length="25"></o-nif-input>
                </o-column>
                <o-column title="HOST_AVAILABLE" layout-align="start stretch" fxFlex="80">
                    <o-slide-toggle attr="host" label="ACTIVEHOST" (onChange)="toggleHost($event)"
                        fxFlex="80"></o-slide-toggle>
                </o-column>

            </o-form>
        </mat-tab>

        <!-- Pestaña para gestionar reservas (cambiar nombre de la tab y reducir espacio entre grid-items) -->

        <mat-tab label="{{ 'RESERVATION_TAB' | oTranslate }}">


            <o-grid #gridReservationReceived attr="reservationReceived" service="users" entity="reservationReceived"
                columns="id_reservation;name_traveler;surname_traveler;name_host;surname_host;message;status_name;reservation_date"
                query-rows="8" refresh-button="no" quick-filter="true"
                quick-filter-columns="name_traveler;surname_traveler;message;status_name"
                visible-columns="name_host;message;status_name;reservation_date" [cols]="1" grid-item-height="60px"
                gutter-size="6px" show-footer="no">

                <o-grid-item *ngFor="let list of gridReservationReceived.dataArray">

                    <div class="container">
                        <div class="row">

                            <div class="itemrow1">
                                <div class="nameT">{{'Message from' | oTranslate}} {{ list.name_traveler}}
                                    {{list.surname_traveler}}</div>
                                <div class="msg">{{ list.message }}</div>
                            </div>

                            <div class="itemrow2">
                                <div class="date">{{'Reservation Date' | oTranslate}}</div>
                                <div class="dateFormat">{{ list.reservation_date | date: 'dd/MM/yyyy' }}</div>
                            </div>

                            <div class="itemrow3">
                                <div class="reserv">{{'Reservation' | oTranslate}}</div>
                                <div class="status" *ngIf="list.status_name==='rechazada'">{{ 'REJECTED' | oTranslate }}
                                </div>
                                <div class="status" *ngIf="list.status_name==='pendiente'">{{ 'PENDING' | oTranslate}}
                                </div>
                                <div class="status" *ngIf="list.status_name==='aceptada'">{{ 'ACCEPTED' | oTranslate }}
                                </div>
                                <div class="status" *ngIf="list.status_name==='anuladaporhost'">{{ 'CANCELED' |
                                    oTranslate }}</div>
                                <div class="status" *ngIf="list.status_name==='anuladaportrav'">{{ 'CANCELED' |
                                    oTranslate }}</div>
                            </div>

                            <div class="itemrow4">
                                <div class="showMsg" (click)="verReservaRec(list.id_reservation)">
                                    <img src="../../../../assets/icons/eyeIcon.png" alt="icon">
                                </div>
                            </div>

                            <div class="itemrow5">
                                <div class="showProf">{{'SHOWPROFILE' | oTranslate}}</div>
                            </div>
                            <div class="msg"><span>{{ list.message_answer }}</span></div>
                        </div>
                    </div>
                </o-grid-item>
            </o-grid>

            <o-grid #gridReservationSent attr="reservationSent" service="users" entity="reservationSent"
                columns="id_reservation;name_traveler;surname_traveler;name_host;surname_host;message;status_name;reservation_date"
                query-rows="8" refresh-button="no" quick-filter="true"
                visible-columns="name_host;message;status_name;reservation_date" [cols]="1" grid-item-height="60px"
                gutter-size="6px" show-footer="no">

                <o-grid-item *ngFor="let list of gridReservationSent.dataArray">


                    <div class="container">
                        <div class="row">

                            <div class="itemrow1">
                                <div class="nameT">{{'Message from' | oTranslate}} {{ list.name_traveler}}
                                    {{list.surname_traveler}}</div>
                                <div class="msg">{{ list.message }}</div>
                            </div>

                            <div class="itemrow2">
                                <div class="date">{{'Reservation Date' | oTranslate}}</div>
                                <div class="dateFormat">{{ list.reservation_date | date: 'dd/MM/yyyy' }}</div>
                            </div>

                            <div class="itemrow3">
                                <div class="reserv">{{'Reservation' | oTranslate}}</div>
                                <div class="status" *ngIf="list.status_name==='rechazada'">{{ 'REJECTED' | oTranslate }}
                                </div>
                                <div class="status" *ngIf="list.status_name==='pendiente'">{{ 'PENDING' | oTranslate}}
                                </div>
                                <div class="status" *ngIf="list.status_name==='aceptada'">{{ 'ACCEPTED' | oTranslate }}
                                </div>
                                <div class="status" *ngIf="list.status_name==='anuladaporhost'">{{ 'CANCELED' |
                                    oTranslate }}</div>
                                <div class="status" *ngIf="list.status_name==='anuladaportrav'">{{ 'CANCELED' |
                                    oTranslate }}</div>
                            </div>

                            <div class="itemrow4">
                                <div class="showMsg" (click)="verReservaSent(list.id_reservation)">
                                    <img src="../../../../assets/icons/eyeIcon.png" alt="icon">
                                </div>
                            </div>

                            <div class="itemrow5">
                                <div class="showProf">{{'SHOWPROFILE' | oTranslate}}</div>
                            </div>
                            <div class="msg"><span>{{ list.message_answer }}</span></div>
                        </div>
                    </div>
                </o-grid-item>
            </o-grid>

        </mat-tab>
    </mat-tab-group>

</o-form-container>